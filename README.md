## Хранилище сканов документов, подключаемое к типовым конфигурациям 1С



Данное решение представляет собой набор отчетов и обработок (**на обычных формах**), которые могут быть подключены к базам 1Сv8. Конфигурации должны поддерживать механизм внешних обработок (например, типовые 1С:БП 2.0, ЗУП 2.5 и т.д.). Решение позволяет прикреплять произвольное количество изображений (например, сканов) к документам и справочникам 1С. При этом изображения хранятся во внешней базе данных MS SQL (*хранение картинок в базе T-SQL, а не в файловой системе оправдано соображениями конфиденциальности*). Также реализованы сохранение и просмотр истории работы с изображениями. 

### Оглавление
- [Настройка системы](#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B)
- [Работа со сканами документов](#%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81%D0%BE-%D1%81%D0%BA%D0%B0%D0%BD%D0%B0%D0%BC%D0%B8-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2)
- [Работа со сканами договоров и учредительных документов контрагентов](#%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81%D0%BE-%D1%81%D0%BA%D0%B0%D0%BD%D0%B0%D0%BC%D0%B8-%D0%B4%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D1%80%D0%BE%D0%B2-%D0%B8-%D1%83%D1%87%D1%80%D0%B5%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2-%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%BE%D0%B2)
- [Отчеты по системе хранения сканов](#%D0%BE%D1%82%D1%87%D0%B5%D1%82%D1%8B-%D0%BF%D0%BE-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B5-%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F-%D1%81%D0%BA%D0%B0%D0%BD%D0%BE%D0%B2)


### Настройка системы

1. Установить MS SQL Server (решение тестировалось на MS SQL Server 2019 express)
2. Создать пустую БД MS SQL с имененем "DocScans".
3. В каждой из обработок/отчетов в области основной программы у форм заменить строку подключения к MS SQL. Подключение осуществляется через OLE DB. Строка подключения имеет примерный вид "Provider=MSOLEDBSQL;Server=DESKTOP-LIH7SPO\SQLEXPRESS;Database=DocScans;Trusted_Connection=yes;" Подробнее о формировании строки подключения см., например, [здесь](https://qastack.ru/programming/10479763/how-to-get-the-connection-string-from-a-database).

4. Открыть внешнюю обработку "АдминистрированиеБДСканыДокументов.epf" и нажать кнопку "Пересоздать таблицы БД" (см. скриншот).

![Обработка "Администрирование БД Сканы"](https://raw.githubusercontent.com/tyashin/1C-scan-storage/main/screenshots/scr1.png) 

5. Добавить обработку "СканыДокументов.epf" в справочник "Внешние обработки" под именем "Сканы документов", с видом "Печатная форма" и указать типы объектов (документов и справочников), из которых обработка будет вызываться (см. скриншоты). 

![Справочник "Внешние обработки"](https://raw.githubusercontent.com/tyashin/1C-scan-storage/main/screenshots/scr2.png) ![Элемент справочника "Внешние обработки"](https://raw.githubusercontent.com/tyashin/1C-scan-storage/main/screenshots/scr3.png)

### Работа со сканами документов

Через пункт меню "Печать" ->"Сканы документов" соответствующих документов и справочников можно вызвать диалог для работы со сканами (см. скриншот).

![Обработка "Сканы документов"](https://raw.githubusercontent.com/tyashin/1C-scan-storage/main/screenshots/scr4.png)

В данном диалоге можно добавлять, удалять и фиксировать факт проверки скана документа. При этом в БД записывается изображение, дата добавления/проверки и ответственное лицо (пользователь 1С), выполнивший операцию. Для просмотра скана следует установить курсор на соответствющую строку табличной части и нажать кнопку с картинкой в правом верхнем углу диалога ("1" - на скриншоте выше).

При необходимости, можно переподключиться к БД MS SQL непосредственно из Диалога работы со сканами (кнопка "Подключиться к БД" в правом нижнем углу формы).

Для просмотра истории работы с изображением (сканом) следует нажать кнопку "История" ("3" - на скриншоте выше). В истории фиксируются факты добавления, удаления и проверки сканов. Форма просмотра истории:

![Форма просмотра истории](https://raw.githubusercontent.com/tyashin/1C-scan-storage/main/screenshots/scr5.png)



### Работа со сканами договоров и учредительных документов контрагентов

Для возможности работы со сканами договоров и учредительных документов следует подключить обработку "СканыДокументов.epf" как внешнюю печатную форму к справочникам "Договоры" и "Контрагенты" соответственно (см. [Настройка системы](#%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B)). Порядок работы с формой "Сканы документов" описан [выше](#%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0-%D1%81%D0%BE-%D1%81%D0%BA%D0%B0%D0%BD%D0%B0%D0%BC%D0%B8-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2).

Для удобства просмотра и добавления сканов договоров и учредительных документов можно использовать внешнюю обработку "СканыДоговоровИУчредДокКонтрагентов.epf" (см. скриншот).

![Форма просмотра и добавления сканов договоров и учредительных документов](https://raw.githubusercontent.com/tyashin/1C-scan-storage/main/screenshots/scr7.png)

Для открытия диалога работы со сканами учред. документов контрагента следует указать контрагента в шапке формы и нажать кнопку "Сканы учредительных документов". Для открытия диалога работы со сканами конкретного договора следует установить курсор на строку с договором в табличной части и нажать кнопку "Сканы договоров" (или выполнить двойной клик в первой колонке в строке табличной части.) Пиктограмма с картинкой в строке табличной части указывает на наличие сохраненных сканов для конкретного договора.

### Отчеты по системе хранения сканов

Отчеты "Отчет по сканам договоров" и "Отчет по системе хранения сканов" (см. скриншоты ниже), в отличие от вышеописанных обработок, не являются универсальными. Они работоспособны только в 1С БП 2.0. Работа с этими отчетами является интуитивно понятной: в шапке отчетов следует установить отборы и затем нажать кнопку "Сформировать".

![Отчет по сканам договоров](https://raw.githubusercontent.com/tyashin/1C-scan-storage/main/screenshots/scr6.png)

![Отчет по системе хранения сканов](https://raw.githubusercontent.com/tyashin/1C-scan-storage/main/screenshots/scr9.png)
